{{template "base" .}}

{{define "title"}}
    Mobile Poker Page
{{end}}


{{define "content"}}
    {{with $td := .}}
        <div id="table" padding=10>
            {{with $td.Data.pocketCards}}
                {{if eq .card1.Num 0}}
                    <img src="/static/cardsIMG/backside.jpg" id="Card1" width=200>
                    <img src="/static/cardsIMG/backside.jpg" id="Card2" width=200>
                {{else}}
                    <img src="/static/cardsIMG/{{- .card1.Num -}}_of_{{- .card1.Suit -}}.png" id="Card1" width=200>
                    <img src="/static/cardsIMG/{{- .card2.Num -}}_of_{{- .card2.Suit -}}.png" id="Card2" width=200>
                {{end}}
            {{end}}
        </div>
        <div class="bettingbutton">
            {{if $td.Data.isPlaying}}
            <form method="post">
                <input type="hidden" name="csrf_token" value="{{$td.CSRFToken}}">
                <div class="form-inline">
                    <button type="submit" formaction="/mobilepoker/action/check" class="btn btn-primary" name="action" value="check">Check</button>
                    <label class="control-label">Bet Size: 
                        <input type="text" class="form-control" name="Bet">
                        <button type="submit" formaction="/mobilepoker/action/bet" class="btn btn-primary" name="action" value="bet">Bet</button>
                    </label>
                    <button type="submit" formaction="/mobilepoker/action/call" class="btn btn-primary" name="action" value="call">Call</button>
                    <button type="submit" formaction="/mobilepoker/action/fold" class="btn btn-primary" name="action" value="fold">Fold</button>
                    <button type="submit" formaction="/mobilepoker/action/all-in" class="btn btn-primary" name="action" value="all-in">All in</button>
                </div>
            </form>
            {{else}}
                <p>Please wait for the next game!</p>
            {{end}}
        </div>
        
        <div id="stack">
            <p>Your Stack Size: {{.Data.stack}}</p>
        </div>
        {{if $td.Data.isPlaying}}
            <div>
                <p>Raiser:</p>
                <p id="originalRaiser"></p>
                <p>Bet Size:</p>
                <p id="betSize"></p>
            </div>
        {{end}}
        <div>
            {{with $p := $td.Data.playerSeat}}
                {{if eq $p "Preset Player"}}
                    <form action="/mobilepoker/init" method="post" style="display: inline;">
                        <input type="hidden" name="csrf_token" value="{{$td.CSRFToken}}">
                        <select class="form-control" name="PlayerSeat">
                            <option value="Player1">Player1</option>
                            <option value="Player2">Player2</option>
                            <option value="Player3">Player3</option>
                            <option value="Player4">Player4</option>
                            <option value="Player5">Player5</option>
                            <option value="Player6">Player6</option>
                            <option value="Player7">Player7</option>
                            <option value="Player8">Player8</option>
                            <option value="Player9">Player9</option>
                        </select>
                        <input type="submit" class="btn btn-primary" value="Init">
                    </form>
                {{else}}
                    <p>Player Seat: {{$p}}</p>
                {{end}}
            {{end}}
        </div>
    {{end}}
{{end}}


{{define "js"}}
    <script>
        console.log("Waiting Ajax")
        waitingturn();
        function waitingturn(){
            $.ajax({
            url: '/mobilepoker/waitingturn',
            dataType: 'json',
            success: function(data) {
                if (data["BetSize"] >= 0) {
                    $('#betSize').text(data["BetSize"]);
                    $('#originalRaiser').text(data["OriginalRaiser"]);
                    popup("info", "Your Turn", data["OriginalRaiser"] + " bet " + data["BetSize"] + " dollars")
                } else if (data["BetSize"] === -1){
                    Swal.fire({
                        icon:"error",
                        title:"Something went wrong!",
                        text: "Please click OK",
                        confirmButtonText:'<a href="/mobilepoker/start" style="text-decoration:none; color:white; font-size:large; font-weight: bold;">OK</a>'
                    })
                }
                waitingturn()
            },
            error: function(data) {
                alert('error');
                waitingturn()
            }
            });
        }
    </script>
{{end}}