{{template "base" .}}

{{define "title"}}
    Poker
{{end}}


{{define "content"}}
    <div id="table" padding=10></div>
    <div>
        <button type="button" class="btn btn-primary" onclick="displayCards()">Change</button>
        <button type="button" class="btn btn-primary" onclick="frop()">Frop</button>
        <button type="button" class="btn btn-primary" onclick="turn()">Turn</button>
        <button type="button" class="btn btn-primary" onclick="river()">River</button>
    </div>
{{end}}


{{define "js"}}
    <script>
        class Card {
            constructor(num, suit, id){
                this.num = num;
                this.suit = suit;
                this.id = id;
            }
        }
        let communityCards = new Array();
        displayCards();
        function displayCards(){
            let N = 5;
            let text = "";
            //fill from 0 to 51
            let num_arr = Array.from(Array(52).keys());
            for(let i = 0, len = num_arr.length; i < N; i++, len--) {
                let rndNum = Math.floor(Math.random()*len);
                let num = num_arr[rndNum]
                num_arr[rndNum] = num_arr[len-1];
                //ランダムに得られた数字をカード番号、記号に変換
                let [cardNum, cardSuit] = numSuit(num); 
                //number + suit でIDを設定
                imgID = String(cardNum) + cardSuit;
                //communinty cardsの決定、保存
                communityCards.push(new Card(cardNum, cardSuit, imgID));
                //imgタグのid属性を上で通し番号を文字列にしたものとして、クリックしたらその番号を引数に入れて関数を呼び出す
                text += '<img src="/static/cardsIMG/backside.jpg" id=' + communityCards[i].id + ' width=200>';
            }
            console.log(text);
            document.getElementById("table").innerHTML = text;
        }
        function frop(){
            for(let i = 0; i < 3; i++){
                //カードを裏の画像から表の画像に切り替える
                document.getElementById(communityCards[i].id).src = "/static/cardsIMG/" + communityCards[i].num + "_of_" + communityCards[i].suit + ".png";
            }
        }
        function turn(){
            for(let i = 3; i < 4; i++){
                //カードを裏の画像から表の画像に切り替える
                document.getElementById(communityCards[i].id).src = "/static/cardsIMG/" + communityCards[i].num + "_of_" + communityCards[i].suit + ".png";
            }
        }
        function river(){
            for(let i = 4; i < 5; i++){
                //カードを裏の画像から表の画像に切り替える
                document.getElementById(communityCards[i].id).src = "/static/cardsIMG/" + communityCards[i].num + "_of_" + communityCards[i].suit + ".png";
            }
        }
        //画像を切り替える関数
        function changeImg(id){
            //クリックされた画像のid名で要素を指定し、そのsrc属性だけ書き換える
            document.getElementById(id).src = "/static/cardsIMG/1_of_spades.png";
        }

        //数字と記号を決定する関数
        function numSuit(num){
            const suits_arr = ["clubs","diamonds","hearts","spades"];
            let card_num = num%13 + 1;
            let card_suit = suits_arr[Math.floor(num/13)];
            return [card_num, card_suit];
        }
    </script>
{{end}}